{% extends "base.html.twig" %} 
{% block title %} 
{{app.user.name}}
 {% endblock %} 

 {% block stylesheets %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
{% endblock %}

    {% block body %}

    <div class="container rounded bg-white mt-5 mb-5">
    <div class="row">
        <div class="col-md-3 border-right">
            <div class="d-flex flex-column align-items-center text-center p-3 py-5">
            {% if user.photo is not null %}
            <img class="rounded-circle mt-5" width="150px" src="{{ path('photo_user', {'id': user.id} ) }}">
            {% else %}
            <img class="rounded-circle mt-5" width="150px" src="../images/avatar.png">
            {% endif %}
            <span class="font-weight-bold">{{user.name}}</span><span class="text-black-50">{{user.email}}</span><span> </span></div>
            <a  class="d-flex flex-column align-items-center text-center" href="{{ path('app_series_index')}}"><button class="btn btn-primary btn-block" type="button">Retour</button></a>
        </div>
        <div class="col-md-5 border-right">
            <div class="p-3 py-5">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="text-right">Mon compte</h4>
                </div>
                <div class="row mt-2 info">
                    <div class="col-md-6"><label class="labels">Nom :</label><br>{{user.name}}</div>
                    <div class="col-md-6"><label class="labels">Email :</label><br>{{user.email}}</div>
                    <div class="col-md-6"><label class="labels">Pays :</label><br>{{user.country}}</div>
                </div>
                {% if is_granted('IS_IMPERSONATOR') %}

                {% else %}
                <div class="row mt-10 frorm">
                  {{form_start(form)}}
                  <div class="col-md-6"><label class="labels">Nom</label>{{form_row(form.name)}}</div>
                    <div class="col-md-6"><label class="labels">Email</label>{{form_row(form.email)}}</div>
                    <div class="col-md-6"><label class="labels">Pays</label>{{form_row(form.country)}}</div>
                    <div class="col-md-6"><label class="labels">Mot de passe</label>{{form_row(form.plainPassword)}}</div>
                    <div class="col-md-6"><label class="labels">Photo de profil</label>{{form_row(form.photo)}}</div>
                    <div class="col-md-6"><label class="d-flex flex-column align-items-center text-center py-2">Valider</label> <div class="d-flex flex-column align-items-center text-center">{{form_row(form.agreeTerms)}}<div></div>   
                    <div class="d-flex align-items-center mb-3 p-3">
                        <div class="submit">  {{form_row(form.submit)}}</div>
                        <div> <button class="btn btn-danger stop" type="button">Annuler</button></div>
                    </div>
                    {{form_end(form)}}              
                </div>
            </div>
        </div>
        {% if user == app.user %}
            <button class="mt-4 btn btn-primary profile-button" type="button">Modifier mon compte</button>
        {% endif %}
    </div>
    {% endif %}


</div>
</div>
</div>


<div id="critiques">
    <h2>Récapitulatifs des critiques</h2>
    {% for rating in ratings %}
        <div class="bloc_critique">
            <p>{{ rating.comment }}</p>
            <p>{{ rating.value }}</p>
            <p>------------</p>
        </div>
    {% endfor %}
</div>

<div id="content">
    <h1>Vos séries favorites</h1>
    <table class="table">
        <tbody id="afficheSeries">
            {% for series in user.series %}
                <tr id="serie">
                    <td><img src="{{ path('poster_series_show', {'id': series.id} ) }}"/></td>
                    <td>{{ series.title }}</td>

                    <td>
                        <a class="boutonModif" href="{{ path('app_series_show', {'id': series.id}) }}">Afficher</a>
                        {% if user == app.user %}
                            <a class="boutonModif" href="{{ path('app_series_show_adds', {'series': series.id, 'yesno': "0", 'redirect': "0" }) }}">Supprimer</a>
                        {% endif %}
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="11">no records found</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>



<div id="history">
    {% for episode in user.episode %}
        <tr id="serie">
            <td>{{episode.season.series.title}}</td>
            <td><img src="{{ path('poster_series_show', {'id': episode.season.series.id} ) }}"/></td>
            <td>{{episode.number}} {{ episode.title }}</td>

            <td>
                <a class="boutonModif" href="{{ path('app_series_show', {'id': episode.season.series.id}) }}">Afficher</a>
                {% if user == app.user %}
                    <a class="boutonModif" href="{{ path('app_series_show_seen_adds', {'series': episode.season.series.id, 'episode': episode.id, 'yesno': "0"}) }}">Supprimer</a>
                {% endif %}
            </td>
        </tr>
    {% else %}
        <tr>
            <td colspan="11">Aucune série trouvée.</td>
        </tr>
    {% endfor %}
</div>




<script>
var country = document.querySelector('select');
country.value = {{user.country.id}};

var form = document.querySelector('.frorm').style.display = 'none';
var div = document.querySelector('.info').style.display = 'block';
var stop = document.querySelector('.stop').style.display = 'none';
var button = document.querySelector('.profile-button');
button.addEventListener('click', function(){
    stop = document.querySelector('.stop').style.display = 'block';
    form = document.querySelector('.frorm').style.display = 'block';
    div = document.querySelector('.info').style.display = 'none';
    button.style.display = 'none';
})

var stop = document.querySelector('.stop');
stop.addEventListener('click', function(){
    stop = document.querySelector('.stop').style.display = 'none';
    form = document.querySelector('.frorm').style.display = 'none';
    div = document.querySelector('.info').style.display = 'block';
    button.style.display = 'block';
})

var input = document.querySelector('input[type=file]');
input.addEventListener('change', function(){
    var file = this.files[0];
    var reader = new FileReader();
    reader.addEventListener('load', function(){
        var img = document.querySelector('img');
        img.src = reader.result;
    });
    reader.readAsDataURL(file);
})

var submit = document.querySelector('.submit');
submit.style.marginRight = '10px';

</script>

    {% endblock %} 
